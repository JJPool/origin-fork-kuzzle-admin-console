proxy:
  image: kuzzleio/proxy
  ports:
    - "7511-7513:7511-7513"

backoffice:
  image: kuzzleio/dev
  command: sh -c 'chmod 755 /run.sh && /run.sh'
  volumes:
    - "..:/var/app"
    - "./scripts/run-test.sh:/run.sh"
  ports:
    - "3000:3000"
  links:
    - proxy
    - kuzzle
    # add link to elasticsearch in order to perform a dump
    - elasticsearch
  environment:
    - DEBUG_PHANTOM
    - KUZZLE_URL
    - TRAVIS
    - TRAVIS_COMMIT
    - TRAVIS_JOB_NUMBER
    - TRAVIS_BRANCH
    - TRAVIS_JOB_ID
    - TRAVIS_PULL_REQUEST
    - TRAVIS_REPO_SLUG

kuzzle:
  image: kuzzleio/kuzzle
  volumes:
    - "../kuzzle/fixtures.json:/fixtures.json"
    - "../kuzzle/mappings.json:/mappings.json"
  links:
    - elasticsearch
    - redis
    - proxy
  environment:
    - kuzzle_services__db__host=elasticsearch
    - kuzzle_services__internalCache__node__host=redis
    - kuzzle_services__memoryStorage__node__host=redis
    - kuzzle_services__proxyBroker__host=proxy
    - kuzzle_fixtures=/fixtures.json
    - kuzzle_mappings=/mappings.json

redis:
  image: redis:3.2-alpine

elasticsearch:
  image: kuzzleio/elasticsearch:2.3.4
